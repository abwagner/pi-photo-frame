services:
  photo-frame:
    build: .
    # Or use pre-built image (if you publish one):
    # image: your-registry/pi-photo-frame:latest
    container_name: pi-photo-frame
    restart: unless-stopped
    volumes:
      # Persist uploaded photos
      - photo_uploads:/app/uploads
      # Persist settings, users, gallery data
      - photo_data:/app/data
    # Uncomment to enable HDMI-CEC TV power control:
    # devices:
    #   - "/dev/cec0:/dev/cec0"
    environment:
      - TZ=America/New_York  # Change to your timezone
      - BACKUP_TIME=03:00    # Daily backup time (HH:MM, 24h format)
      - BEHIND_PROXY=1
      - SECURE_COOKIES=1
    # Healthcheck is defined in Dockerfile

    # Resource limits (optional, good for Pi)
    # deploy:
    #   resources:
    #     limits:
    #       memory: 256M

  caddy:
    image: caddy:2-alpine
    container_name: pi-photo-frame-caddy
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
    depends_on:
      - photo-frame

volumes:
  photo_uploads:
    name: photoframe_uploads
  photo_data:
    name: photoframe_data
  caddy_data:
  caddy_config:
